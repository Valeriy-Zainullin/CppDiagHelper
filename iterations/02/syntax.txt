// Если описание закончилось на двоеточие, то следующая диагностика подчинённая.
// Описание с двумя пробелами в начале говорит о том, что текущая диагностика подчинённая.
// Определение описания подразумевает, что оно не может быть короче трёх символов.
// Могут быть проблемы с файлами, в которых более 9999 строк.
// Наложить ограничения!
// Не проверяли с -Werror (чтобы было содержательно, должно найтись предупреждение, ставшее ошибкой
// из-за этого флага).
// Не встречал записи (^ что-то) (по крайней мере, не помню). Придумал сам.

Число = "0" | ((1 .. 9) {0 .. 9}).
Номер_столбца = Число.
Номер_строки = Число.

Символ - любой символ, кроме перевода строки ("\n").
Символ_сигнатуры_функции - любой символ, кроме перевода строки ("\n") и двоеточия (":"),
одинарной ковычки ("'").

Строка = Символ {Символ} "\n".
Строка_кода = Строка.
Описание = ^" " ^" " Строка.
Описание_с_двумя_пробелами_в_начале = "  " Строка.
Сигнатура_функции = Символ_сигнатуры_функции {Символ_сигнатуры_функции}.

Строка_не_here - строка, не являющаяся "here".
Путь_к_файлу - Строка, не начинающаяся с "In file included", не содержащая двоеточий.

Указание = "      |" Строка "\n".
Указания =
	Указание
	{Указание}.
Выдержка_из_кода_с_указаниями = 
	(" ") {" "}  Номер_строки " |" Строка_кода "\n"
	Указания.


Ошибка = ": error: ".
Предупреждение = ": warning: ".	
Замечание = ": note: ".

Путь_подключения_файла = 
	"In file included from " Путь_к_файлу ":" Номер_строки { "," "\n"
	"                 from " Путь_к_файлу ":" Номер_строки } ":" "\n".
Путь_раскрытия_выражения_в_шаблоне =
	Путь_к_файлу ":" Номер_строки ":" Номер_столбца {":   required from " Строка_не_here "\n"
	Путь_к_файлу ":" Номер_строки ":" Номер_столбца} ":   required from here" "\n".
Диагностика =
	[Путь_подключения_файла]
	Путь_к_файлу ":" (
		(
			" In function '" Сигнатура_функции "':\n"
			Путь_к_файлу ":" Номер_строки ":" Номер_столбца (Ошибка | Предупреждение | Замечание)
		) |
		(
			(" In instantiation of " | "In substitution of ") Строка "\n"
			Путь_раскрытия_выражения_в_шаблоне
			Путь_к_файлу ":" Номер_строки ":" Номер_столбца (Ошибка | Предупреждение | Замечание)
		) |
		(Номер_строки ":" Номер_столбца (Ошибка | Предупреждение | Замечание))
	)
	(Описание | Описание_с_двумя_пробелами_в_начале) "\n"
	[Выдержка_из_кода_с_указаниями].

Вывод = {Диагностика} ["cc1plus: all warnings being treated as errors"] {"\n"}.

// ----- Синтаксис после подстановок ----
// (Полезен для проверки однозначности.)
Вывод = {
	[
		"In file included from " Путь_к_файлу ":" Номер_строки { "," "\n"
		"                 from " Путь_к_файлу ":" Номер_строки } ":" "\n".
	]
	Путь_к_файлу ":" (
		(
			" In function '" Сигнатура_функции "':\n"
			Путь_к_файлу ":" Номер_строки ":" Номер_столбца (": error: " | ": warning: " | ": note: ")
		) |
		(
			("In instantiation of " | "In substitution of ") Строка "\n"
			Путь_к_файлу ":" Номер_строки ":" Номер_столбца {":   required from " Строка_не_here "\n"
			Путь_к_файлу ":" Номер_строки ":" Номер_столбца} ":   required from here" "\n".
			Путь_к_файлу ":" Номер_строки ":" Номер_столбца (": error: " | ": warning: " | ": note: ")
		) |
		(Номер_строки ":" Номер_столбца (": error: " | ": warning: " | ": note: "))
	)
	Описание "\n"
	[
		(" ") {" "} Номер_строки " |" Строка_кода "\n"
		("      |" Строка "\n")
		{"      |" Строка "\n"}
	]
} ["cc1plus: all warnings being treated as errors"] {"\n"}.
